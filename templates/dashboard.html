<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <title>Dashboard | National Guard</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/@ttskch/select2-bootstrap4-theme@1.5.2/dist/select2-bootstrap4.min.css" rel="stylesheet">

  <style>
    :root{
      --glass: rgba(10,12,20,.78);
      --glass-strong: rgba(10,12,20,.88);
      --border: rgba(255,255,255,.12);
      --soft: rgba(255,255,255,.85);
      --accent:#ffc107;
      --btn:#22c55e;
      --btn-h:#1fa351;
    }
    body{
      background: url("/static/bg.jpg") center/cover fixed no-repeat;
      color:#fff; font-family:'Segoe UI',sans-serif;
    }
    .wrap{
      max-width: 1100px; margin: 40px auto; padding: 0 16px;
    }
    .panel{
      background: var(--glass);
      border:1px solid var(--border);
      border-radius:20px;
      padding:22px;
      box-shadow: 0 18px 48px rgba(0,0,0,.5);
      backdrop-filter: blur(8px);
    }
    .panel:hover{ background: var(--glass-strong) }

    .head{
      display:flex; align-items:center; justify-content:space-between; gap:12px;
      margin-bottom: 14px;
    }
    .head h2{
      margin:0; font-weight:800; letter-spacing:.2px;
      text-shadow: 0 8px 28px rgba(0,0,0,.6);
    }
    .sub{ color:var(--soft) }

    label{ color:#f1f5f9; font-weight:600; margin-bottom:.45rem }
    .form-text{ color: var(--soft) }

    .form-control, .form-select{
      background:#fff !important; color:#000 !important;
      border:1px solid #ced4da !important; border-radius:.6rem !important;
      padding:.6rem .8rem !important;
    }
    textarea.form-control{ min-height: 86px }

    /* Select2 (Bootstrap4 theme) tweaks */
    .select2-container--bootstrap4 .select2-selection--single{
      height: 44px !important; padding: 6px 10px !important;
      border-radius:.6rem !important; border:1px solid #ced4da !important;
      background:#fff !important;
    }
    .select2-container--bootstrap4 .select2-selection__rendered{
      color:#000 !important; line-height: 30px !important;
    }
    .select2-container--bootstrap4 .select2-results__option{
      color:#000 !important; background:#fff !important;
    }
    .select2-container--bootstrap4 .select2-results__option--highlighted{
      background:#cce5ff !important; color:#000 !important;
    }

    .btn-success{
      background: var(--btn); border:none; font-weight:700;
      padding:.7rem 1.1rem; border-radius:.75rem;
    }
    .btn-success:hover{ background: var(--btn-h) }
    .btn-outline-light, .btn-outline-danger{
      border-radius:.75rem; font-weight:600;
    }

    .inline-actions{
      display:flex; gap:10px; flex-wrap:wrap; align-items:center;
    }
    .link-manual{
      color:#93c5fd; cursor:pointer; text-decoration: underline dotted;
      font-size:.95rem;
    }
    .grid{
      display:grid; gap:16px;
      grid-template-columns: 1fr;
    }
    @media (min-width: 768px){
      .grid{
        grid-template-columns: 1fr 1fr;
      }
      .grid .full{ grid-column: 1 / -1 }
    }

    /* Divider line */
    .soft-line{ border-top:1px dashed var(--border); margin:14px 0 }
  </style>
</head>
<body>

  <div class="wrap">
    <div class="panel">
      <div class="head">
        <div>
          <h2>üõ°Ô∏è –ö–∞–¥—Ä–æ–≤–∏–π –∞—É–¥–∏—Ç ‚Äî –ü–∞–Ω–µ–ª—å –¥—ñ–π</h2>
          <div class="sub">–ó–∞–ø–æ–≤–Ω–∏ –¥–∞–Ω—ñ —Ç–∞ –≤—ñ–¥–ø—Ä–∞–≤ ‚Äî –º–∏ –∑–∞–ª–æ–≥–∏–º–æ —Ü–µ —É Discord —ñ –¥–æ–¥–∞–º–æ –≤ —ñ—Å—Ç–æ—Ä—ñ—é.</div>
        </div>
        <div class="inline-actions">
          <a href="/history" class="btn btn-outline-light">üìã –Ü—Å—Ç–æ—Ä—ñ—è</a>
          <a href="/logout" class="btn btn-outline-danger">üö™ –í–∏–π—Ç–∏</a>
        </div>
      </div>

      <div class="soft-line"></div>

      <form method="POST">
        <div class="grid">

          <!-- –ö–æ–≥–æ -->
          <div class="full">
            <label for="user_id">üë§ –ö–æ–≥–æ</label>
            <div class="mb-2">
              <select class="form-select" id="user_id" name="user_id" required>
                {% for name, uid in members %}
                  <option value="{{ uid }}">{{ name }}</option>
                {% endfor %}
              </select>
            </div>

            <div class="inline-actions">
              <span class="form-text">–ú–æ–∂–µ—à –æ–±—Ä–∞—Ç–∏ –∑—ñ —Å–ø–∏—Å–∫—É –∞–±–æ</span>
              <span id="toggleManual" class="link-manual">–≤–≤–µ—Å—Ç–∏ Discord ID –≤—Ä—É—á–Ω—É</span>
            </div>

            <input type="text" class="form-control mt-2 d-none" id="manual_user_id" placeholder="–í–≤–µ–¥—ñ—Ç—å Discord ID –≤—Ä—É—á–Ω—É (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥ 1234567890)">
          </div>

          <!-- –Ü–º‚Äô—è | –°—Ç–∞—Ç–∏—á–Ω–∏–π ID -->
          <div>
            <label for="full_name_id">üÜî –Ü–º‚Äô—è –ü—Ä—ñ–∑–≤–∏—â–µ | –°—Ç–∞—Ç–∏—á–Ω–∏–π ID</label>
            <input type="text" class="form-control" id="full_name_id" name="full_name_id" placeholder="Nei Wayne | 19311" required>
            <div class="form-text">–§–æ—Ä–º–∞—Ç: –Ü–º‚Äô—è –ü—Ä—ñ–∑–≤–∏—â–µ | —Å—Ç–∞—Ç–∏—á–Ω–∏–πID</div>
          </div>

          <!-- –î—ñ—è -->
          <div>
            <label for="action">üìå –î—ñ—è</label>
            <select class="form-select" id="action" name="action" required>
              <option value="–ü—Ä–∏–π–Ω—è—Ç–æ">–ü—Ä–∏–π–Ω—è—Ç–æ</option>
              <option value="–ü—ñ–¥–≤–∏—â–µ–Ω–æ">–ü—ñ–¥–≤–∏—â–µ–Ω–æ</option>
              <option value="–ü–æ–Ω–∏–∂–µ–Ω–æ">–ü–æ–Ω–∏–∂–µ–Ω–æ</option>
              <option value="–í–∏–≥–Ω–∞–Ω–æ">–í–∏–≥–Ω–∞–Ω–æ</option>
            </select>
          </div>

          <!-- –ù–æ–≤–∞ —Ä–æ–ª—å -->
          <div class="full">
            <label for="role_name">üéñÔ∏è –ù–æ–≤–∞ —Ä–æ–ª—å (–∑–∞ –ø–æ—Ç—Ä–µ–±–∏)</label>
            <input type="text" class="form-control" id="role_name" name="role_name" placeholder="–†–µ–∫—Ä—É—Ç, –ö–∞–¥–µ—Ç, ...">
            <div class="form-text">–ó–∞–ª–∏—à –ø–æ—Ä–æ–∂–Ω—ñ–º, —è–∫—â–æ —Ä–æ–ª—å –Ω–µ –∑–º—ñ–Ω—é—î—Ç—å—Å—è.</div>
          </div>

          <!-- –ü—Ä–∏—á–∏–Ω–∞ -->
          <div class="full">
            <label for="reason">üìù –ü—Ä–∏—á–∏–Ω–∞ (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –∞–±–æ –∫–æ–º–µ–Ω—Ç–∞—Ä)</label>
            <textarea class="form-control" id="reason" name="reason" rows="2" placeholder="https://... –∞–±–æ '–ù–∞–∫–∞–∑ ‚Ññ1 –≤—ñ–¥ 20.07.2025'"></textarea>
          </div>
        </div>

        <div class="d-flex align-items-center mt-3 gap-2">
          <button type="submit" class="btn btn-success">‚úÖ –ó–∞—Å—Ç–æ—Å—É–≤–∞—Ç–∏ –¥—ñ—é</button>
          <a href="/history" class="btn btn-outline-light">üìã –ü–µ—Ä–µ–≥–ª—è–Ω—É—Ç–∏ —ñ—Å—Ç–æ—Ä—ñ—é</a>
        </div>
      </form>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <script>
    $(function () {
      // 1) Select2
      const $sel = $('#user_id').select2({
        theme: 'bootstrap4',
        placeholder: "–û–±–µ—Ä—ñ—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –∞–±–æ –≤–ø–∏—à—ñ—Ç—å –≤—Ä—É—á–Ω—É",
        width: '100%',
        tags: true,              // –¥–æ–∑–≤–æ–ª—è—î –≤–≤–æ–¥–∏—Ç–∏ –Ω–æ–≤–µ –∑–Ω–∞—á–µ–Ω–Ω—è
        createTag: params => ({  // —Å—Ç–≤–æ—Ä—é—î–º–æ —Ç–µ–≥ –∑—ñ —Å–≤–æ–≥–æ –≤–≤–æ–¥—É
          id: params.term,
          text: params.term,
          newOption: true
        }),
        insertTag: (data, tag) => { data.push(tag); }
      });

      // 2) –ü–µ—Ä–µ–º–∏–∫–∞—á "–≤–≤–µ—Å—Ç–∏ Discord ID –≤—Ä—É—á–Ω—É"
      const $manual = $('#manual_user_id');
      $('#toggleManual').on('click', function(){
        $manual.toggleClass('d-none');
        if (!$manual.hasClass('d-none')) { $manual.focus(); }
      });

      // –ö–æ–ª–∏ –≤–≤–µ–ª–∏ –≤—Ä—É—á–Ω—É —ñ –Ω–∞—Ç–∏—Å–Ω—É–ª–∏ Enter –∞–±–æ –≤—Ç—Ä–∞—Ç–∏–ª–∏ —Ñ–æ–∫—É—Å ‚Äî –ø–µ—Ä–µ–Ω–æ—Å–∏–º–æ –≤ Select2
      $manual.on('keydown', function(e){
        if (e.key === 'Enter') { e.preventDefault(); commitManual(); }
      }).on('blur', commitManual);

      function commitManual(){
        const val = $manual.val().trim();
        if (!val) return;
        // –¥–æ–¥–∞—î–º–æ –Ω–æ–≤–∏–π —Ç–µ–≥ —É select2 —ñ –æ–±–∏—Ä–∞—î–º–æ –π–æ–≥–æ
        const newOption = new Option(val, val, true, true);
        $('#user_id').append(newOption).trigger('change');
        $manual.addClass('d-none'); // —Ö–æ–≤–∞—î–º–æ –ø–æ–ª–µ
      }
    });
  </script>
</body>
</html>
