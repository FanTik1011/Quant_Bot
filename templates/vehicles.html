<!doctype html>
<html lang="uk">
<head>
  <meta charset="utf-8">
  <title>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç | BCSD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body{
      background: url("/static/bg.jpg") no-repeat center center fixed;
      background-size: cover;
      min-height: 100vh;
      color: #fff;
      padding-top: 64px;
    }
    .navbar{ background: rgba(0,0,0,.85); }
    .wrap{ backdrop-filter: blur(2px); }
    .card{
      background: rgba(30,30,47,.85);
      border: 0;
      color: #fff;
      border-radius: 1rem;
      overflow: hidden;
      box-shadow: 0 0 25px rgba(0,0,0,.5);
    }
    .card img{ height: 180px; object-fit: cover; }
    .btn-take{ background:#43B581; border:0; }
    .btn-back{ background:#6c757d; border:0; }
  </style>
</head>
<body>

<nav class="navbar fixed-top navbar-dark px-3">
  <span class="navbar-brand">üöì BCSD –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</span>
  <div class="d-flex gap-2">
    <a class="btn btn-back" href="/dashboard">‚Üê –ù–∞–∑–∞–¥</a>
    <a class="btn btn-danger" href="/logout">–í–∏–π—Ç–∏</a>
  </div>
</nav>

<div class="container py-4 wrap">

  {% if request.args.get('ok') %}
    <div class="alert alert-success">‚úÖ –ó–∞–ø–∏—Ç –≤—ñ–¥–ø—Ä–∞–≤–ª–µ–Ω–æ —É Discord. –ö–∞—Ä—Ç–∫–∞ –∞–≤—Ç–æ —Ç–∏–º—á–∞—Å–æ–≤–æ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞.</div>
  {% endif %}
  {% if request.args.get('returned') %}
    <div class="alert alert-info">‚ÑπÔ∏è –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –ø–æ–≤–µ—Ä–Ω—É—Ç–æ. –î—è–∫—É—î–º–æ!</div>
  {% endif %}

  {% if my_rentals and my_rentals|length > 0 %}
    <div class="card mb-4">
      <div class="card-body">
        <h5 class="mb-3">–ú—ñ–π –∞–∫—Ç–∏–≤–Ω–∏–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</h5>
        {% for r in my_rentals %}
          <form class="row align-items-center g-2" method="post" action="/vehicles/return">
            <input type="hidden" name="rental_id" value="{{ r[0] }}">
            <div class="col-md-5"><strong>{{ r[3] }}</strong></div>
            <div class="col-md-3">–ù–æ–º–µ—Ä–∞: <span class="badge bg-light text-dark">{{ r[2] }}</span></div>
            <div class="col-md-2">–í–∑—è–≤: {{ r[6] }}</div>
            <div class="col-md-2 text-end">
              <button class="btn btn-warning w-100" type="submit">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏</button>
            </div>
          </form>
          {% if not loop.last %}<hr class="border-secondary my-3">{% endif %}
        {% endfor %}
      </div>
    </div>
  {% endif %}

  <div class="row g-4">
    {% for v in vehicles %}
    <div class="col-sm-6 col-lg-4">
      <div class="card h-100">
        <img src="{{ v.img }}" alt="{{ v.name }}">
        <div class="card-body d-flex flex-column">
          <h5 class="card-title">{{ v.name }}</h5>
          <p class="mb-2">–ù–æ–º–µ—Ä–∞: <span class="badge bg-light text-dark">{{ v.plate }}</span></p>
          <div class="mt-auto">
            <button
              class="btn btn-take w-100"
              data-bs-toggle="modal"
              data-bs-target="#takeModal"
              data-vid="{{ v.id }}"
              data-name="{{ v.name }}"
              data-plate="{{ v.plate }}"
            >–í–∑—è—Ç–∏ —Ü–µ–π —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</button>
          </div>
        </div>
      </div>
    </div>
    {% endfor %}
    {% if vehicles|length == 0 %}
      <div class="text-center text-muted">–ù–∞—Ä–∞–∑—ñ –≤—Å—ñ –∞–≤—Ç–æ –∑–∞–π–Ω—è—Ç—ñ.</div>
    {% endif %}
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="takeModal" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog">
    <form class="modal-content bg-dark text-white" method="post" action="/vehicles/take">
      <div class="modal-header">
        <h5 class="modal-title">–í–∑—è—Ç–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</h5>
        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="–ó–∞–∫—Ä–∏—Ç–∏"></button>
      </div>
      <div class="modal-body">
        <input type="hidden" name="vehicle_id" id="v-id">
        <div class="mb-2">
          <label class="form-label">–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç</label>
          <input type="text" id="v-name" class="form-control" disabled>
        </div>
        <div class="mb-2">
          <label class="form-label">–ù–æ–º–µ—Ä–∞</label>
          <input type="text" id="v-plate" class="form-control" disabled>
        </div>
        <div class="mb-3">
          <label class="form-label">–ù–∞ —è–∫–∏–π —á–∞—Å</label>
          <input name="duration" class="form-control" placeholder="–Ω–∞–ø—Ä. 2 –≥–æ–¥–∏–Ω–∏ / –¥–æ 18:00" required>
        </div>
        <div class="mb-3">
          <label class="form-label">–ü—Ä–∏—á–∏–Ω–∞</label>
          <textarea name="reason" class="form-control" rows="3" placeholder="–ö–æ—Ä–æ—Ç–∫–æ –ø–æ —Å—É—Ç—ñ" required></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" type="button" data-bs-dismiss="modal">–°–∫–∞—Å—É–≤–∞—Ç–∏</button>
        <button class="btn btn-success" type="submit">–ü—ñ–¥—Ç–≤–µ—Ä–¥–∏—Ç–∏</button>
      </div>
    </form>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
  const takeModal = document.getElementById('takeModal');
  takeModal.addEventListener('show.bs.modal', e => {
    const btn = e.relatedTarget;
    document.getElementById('v-id').value    = btn.dataset.vid;
    document.getElementById('v-name').value  = btn.dataset.name;
    document.getElementById('v-plate').value = btn.dataset.plate;
  });
</script>
</body>
</html>
