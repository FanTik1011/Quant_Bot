<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç | BCSD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    :root{
      --glass: rgba(11,14,24,.78);
      --glass-strong: rgba(11,14,24,.88);
      --border: rgba(255,255,255,.12);
      --soft: rgba(255,255,255,.85);
      --plate:#ffd54f;
      --take:#f59e0b;
      --take-h:#d97706;
      --return:#22c55e;
      --return-h:#16a34a;
    }
    body{
      background:
        radial-gradient(1100px 520px at 110% -10%, rgba(88,101,242,.18), transparent 55%),
        radial-gradient(1000px 780px at -15% 120%, rgba(14,165,233,.16), transparent 60%),
        url("/static/bg.jpg") center/cover fixed no-repeat;
      color:#fff; font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
    }

    .topbar{
      position:sticky; top:0; z-index:50;
      background: rgba(6,8,14,.7); backdrop-filter: blur(8px);
      border-bottom: 1px solid var(--border);
    }
    .brand{ font-weight:900; letter-spacing:.3px; text-shadow:0 10px 24px rgba(0,0,0,.5) }

    .panel{
      background: var(--glass); border:1px solid var(--border); border-radius:22px;
      padding:18px; box-shadow:0 20px 60px rgba(0,0,0,.55); backdrop-filter: blur(8px);
    }
    .section-head{ display:flex; align-items:center; justify-content:space-between; gap:12px; }
    .section-head small{ color:var(--soft) }

    .vehicle-card{
      background: rgba(255,255,255,.04);
      border:1px solid var(--border);
      border-radius:18px; overflow:hidden;
      transition:.25s; height:100%;
    }
    .vehicle-card:hover{ transform: translateY(-2px); background: rgba(255,255,255,.06) }
    .vehicle-photo{ width:100%; height:170px; object-fit:cover; display:block; }
    .vehicle-body{ padding:14px }
    .vehicle-title{ display:flex; align-items:center; justify-content:space-between; gap:10px }
    .plate{
      background: var(--plate); color:#000; font-weight:900;
      border-radius:12px; padding:.25rem .55rem; letter-spacing:.3px;
      box-shadow:0 0 16px rgba(255,213,79,.35);
    }
    .muted{ color:var(--soft) }

    .form-control{
      background:#fff !important; color:#000 !important;
      border:1px solid #d0d7e2 !important; border-radius:.8rem !important;
      padding:.65rem .85rem !important;
    }
    .form-control:focus{
      border-color:#c4b5fd !important;
      box-shadow:0 0 0 .2rem rgba(139,92,246,.25) !important;
    }

    .btn-take{
      background: var(--take); border:none; color:#1f1300; font-weight:800;
      border-radius:.9rem; padding:.65rem .9rem; width:100%;
    }
    .btn-take:hover{ background: var(--take-h) }

    .btn-return{
      background: var(--return); border:none; color:#001b0a; font-weight:800;
      border-radius:.9rem; padding:.6rem .9rem;
    }
    .btn-return:hover{ background: var(--return-h) }
  </style>
</head>
<body>

  <!-- Topbar -->
  <div class="topbar">
    <div class="container py-3 d-flex align-items-center justify-content-between">
      <h2 class="brand m-0">üöì –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç ‚Äî BCSD</h2>
      <div class="d-flex gap-2">
        <a href="/logout" class="btn btn-outline-danger">üö™ –í–∏–π—Ç–∏</a>
      </div>
    </div>
  </div>

  <div class="container my-3">

    <!-- –°—Ç–∞—Ç—É—Å -->
    {% set ok = request.args.get('ok') %}
    {% set returned = request.args.get('returned') %}
    {% set err = request.args.get('err') %}
    {% if ok %}
      <div class="alert alert-success border-0 shadow-sm">‚úÖ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –≤–∏–¥–∞–Ω–æ.</div>
    {% endif %}
    {% if returned %}
      <div class="alert alert-success border-0 shadow-sm">‚úÖ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –ø–æ–≤–µ—Ä–Ω–µ–Ω–æ.</div>
    {% endif %}
    {% if err == 'no_id' %}
      <div class="alert alert-warning border-0 shadow-sm">‚ö†Ô∏è –ù–µ –ø–µ—Ä–µ–¥–∞–Ω–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è.</div>
    {% elif err == 'not_found' %}
      <div class="alert alert-warning border-0 shadow-sm">‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω–∏–π –∑–∞–ø–∏—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–±–æ –≤–∂–µ –∑–∞–∫—Ä–∏—Ç–∏–π.</div>
    {% elif err %}
      <div class="alert alert-danger border-0 shadow-sm">‚ùå –ü–æ–º–∏–ª–∫–∞: {{ err }}</div>
    {% endif %}

    <!-- –î–æ—Å—Ç—É–ø–Ω—ñ –∞–≤—Ç–æ -->
    <div class="panel mb-3">
      <div class="section-head mb-2">
        <h4 class="m-0">–î–æ—Å—Ç—É–ø–Ω—ñ –∑–∞—Ä–∞–∑</h4>
        <small>–í—ñ–¥–æ–±—Ä–∞–∂–∞—é—Ç—å—Å—è –ª–∏—à–µ –≤—ñ–ª—å–Ω—ñ –æ–¥–∏–Ω–∏—Ü—ñ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É</small>
      </div>

      <div class="row g-3">
        {% for v in vehicles %}
          <div class="col-sm-6 col-lg-4">
            <div class="vehicle-card h-100">
              <img class="vehicle-photo" src="{{ v.img }}" alt="{{ v.name }}">
              <div class="vehicle-body">
                <div class="vehicle-title">
                  <strong>{{ v.name }}</strong>
                  <span class="plate">{{ v.plate }}</span>
                </div>

                <form method="post" action="/vehicles/take" class="mt-3">
                  <!-- –í–∞–∂–ª–∏–≤–æ: –ø–µ—Ä–µ–¥–∞—î–º–æ —ñ vehicle_id, —ñ –∫–æ–Ω—Ç—Ä–æ–ª—å–Ω—É plate -->
                  <input type="hidden" name="vehicle_id" value="{{ v.id }}">
                  <input type="hidden" name="plate_client" value="{{ v.plate }}">

                  <div class="mb-2">
                    <input name="duration" class="form-control" placeholder="–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å (–Ω–∞–ø—Ä. 2 –≥–æ–¥.)" required>
                  </div>
                  <div class="mb-2">
                    <input name="reason" class="form-control" placeholder="–ü—Ä–∏—á–∏–Ω–∞" required>
                  </div>
                  <button class="btn btn-take">–í–∑—è—Ç–∏</button>
                </form>
              </div>
            </div>
          </div>
        {% else %}
          <div class="col-12">
            <div class="text-center muted py-4">–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É.</div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- –ú–æ—ó –∞–∫—Ç–∏–≤–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è -->
    <div class="panel">
      <div class="section-head mb-2">
        <h4 class="m-0">–ú–æ—ó –∞–∫—Ç–∏–≤–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</h4>
        <small>–¢—É—Ç –º–æ–∂–Ω–∞ –ø–æ–≤–µ—Ä–Ω—É—Ç–∏ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç</small>
      </div>

      <div class="row g-3">
        {% for r in my_rentals %}
          {# r: (id, vehicle_id, plate, model, duration, reason, taken_at) #}
          <div class="col-md-6">
            <div class="vehicle-card h-100">
              <div class="vehicle-body">
                <div class="d-flex justify-content-between align-items-start">
                  <div class="d-flex align-items-center gap-2">
                    <strong>{{ r[3] }}</strong>
                    <span class="plate">{{ r[2] }}</span>
                  </div>
                  <small class="muted">{{ r[6] }}</small>
                </div>

                <div class="muted mt-2">‚è≥ –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å: {{ r[4] }}</div>
                <div class="muted">üìù –ü—Ä–∏—á–∏–Ω–∞: {{ r[5] }}</div>

                <form method="post" action="/vehicles/return" class="mt-3">
                  <input type="hidden" name="rental_id" value="{{ r[0] }}">
                  <button class="btn btn-return">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏</button>
                </form>
              </div>
            </div>
          </div>
        {% else %}
          <div class="col-12">
            <div class="text-center muted py-4">–ê–∫—Ç–∏–≤–Ω–∏—Ö –±—Ä–æ–Ω—é–≤–∞–Ω—å –Ω–µ–º–∞—î.</div>
          </div>
        {% endfor %}
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
