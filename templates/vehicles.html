<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <title>–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç | BCSD</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
  />
  <style>
    body{background:url("/static/bg.jpg") center/cover fixed no-repeat;color:#fff}
    .card{background:rgba(0,0,0,.75);border-radius:16px;backdrop-filter:blur(4px)}
    .vehicle-card img{width:100%;height:160px;object-fit:cover;border-radius:12px}
    .muted{opacity:.85}
    .badge-plate{background:#ffc107;color:#000}
    .sticky-topbar{position:sticky;top:0;z-index:9;background:rgba(0,0,0,.6);backdrop-filter:blur(4px)}
  </style>
</head>
<body>
  <div class="sticky-topbar">
    <div class="container py-3 d-flex justify-content-between align-items-center">
      <h2 class="m-0">üöì –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç ‚Äî BCSD</h2>
      <div class="btn-group">
        <a href="/dashboard" class="btn btn-outline-light">Dashboard</a>
        <a href="/history" class="btn btn-outline-warning">–Ü—Å—Ç–æ—Ä—ñ—è</a>
        <a href="/logout" class="btn btn-outline-danger">–í–∏–π—Ç–∏</a>
      </div>
    </div>
  </div>

  <div class="container py-3">

    {# ---- –ê–õ–ï–†–¢–ò –°–¢–ê–¢–£–°–£ ---- #}
    {% set ok = request.args.get('ok') %}
    {% set returned = request.args.get('returned') %}
    {% set err = request.args.get('err') %}

    {% if ok %}
      <div class="alert alert-success border-0 shadow-sm">‚úÖ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –≤–∏–¥–∞–Ω–æ.</div>
    {% endif %}
    {% if returned %}
      <div class="alert alert-success border-0 shadow-sm">‚úÖ –¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç –ø–æ–≤–µ—Ä–Ω–µ–Ω–æ.</div>
    {% endif %}
    {% if err == 'no_id' %}
      <div class="alert alert-warning border-0 shadow-sm">‚ö†Ô∏è –ù–µ –ø–µ—Ä–µ–¥–∞–Ω–æ —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è.</div>
    {% elif err == 'not_found' %}
      <div class="alert alert-warning border-0 shadow-sm">‚ö†Ô∏è –ê–∫—Ç–∏–≤–Ω–∏–π –∑–∞–ø–∏—Å –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ –∞–±–æ –≤–∂–µ –∑–∞–∫—Ä–∏—Ç–∏–π.</div>
    {% elif err %}
      <div class="alert alert-danger border-0 shadow-sm">‚ùå –ü–æ–º–∏–ª–∫–∞: {{ err }}</div>
    {% endif %}

    <!-- –î–æ—Å—Ç—É–ø–Ω—ñ –∞–≤—Ç–æ -->
    <div class="d-flex justify-content-between align-items-center mb-2">
      <h4 class="m-0">–î–æ—Å—Ç—É–ø–Ω—ñ –∑–∞—Ä–∞–∑</h4>
      <small class="text-white-50">–ü–æ–∫–∞–∑—É—é—Ç—å—Å—è –ª–∏—à–µ –∞–≤—Ç–æ, —è–∫—ñ –Ω—ñ—Ö—Ç–æ –Ω–µ —Ç—Ä–∏–º–∞—î</small>
    </div>

    <div class="row g-3">
      {% for v in vehicles %}
        <div class="col-md-4">
          <div class="card p-3 vehicle-card h-100 shadow-sm">
            <img src="{{ v.img }}" alt="{{ v.name }}" />
            <div class="mt-3">
              <div class="d-flex justify-content-between align-items-center">
                <strong>{{ v.name }}</strong>
                <span class="badge badge-plate">{{ v.plate }}</span>
              </div>

              <form method="post" action="/vehicles/take" class="mt-3">
                <input type="hidden" name="vehicle_id" value="{{ v.id }}" />
                <div class="mb-2">
                  <input
                    name="duration"
                    class="form-control"
                    placeholder="–¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å (–Ω–∞–ø—Ä. 2 –≥–æ–¥.)"
                    required
                  />
                </div>
                <div class="mb-2">
                  <input
                    name="reason"
                    class="form-control"
                    placeholder="–ü—Ä–∏—á–∏–Ω–∞"
                    required
                  />
                </div>
                <button class="btn btn-warning w-100">–í–∑—è—Ç–∏</button>
              </form>
            </div>
          </div>
        </div>
      {% else %}
        <div class="col-12">
          <div class="card p-4 text-center">
            <div class="h5 m-0">–ù–µ–º–∞—î –¥–æ—Å—Ç—É–ø–Ω–æ–≥–æ —Ç—Ä–∞–Ω—Å–ø–æ—Ä—Ç—É.</div>
          </div>
        </div>
      {% endfor %}
    </div>

    <hr class="border-secondary my-4" />

    <!-- –ú–æ—ó –∞–∫—Ç–∏–≤–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è -->
    <h4 class="mb-3">–ú–æ—ó –∞–∫—Ç–∏–≤–Ω—ñ –±—Ä–æ–Ω—é–≤–∞–Ω–Ω—è</h4>
    <div class="row g-3">
      {% for r in my_rentals %}
        {# r: (id, vehicle_id, plate, model, duration, reason, taken_at) #}
        <div class="col-md-6">
          <div class="card p-3 h-100">
            <div class="d-flex justify-content-between align-items-start">
              <div>
                <strong>{{ r[3] }}</strong>
                <span class="badge badge-plate ms-2">{{ r[2] }}</span>
              </div>
              <span class="muted">{{ r[6] }}</span>
            </div>
            <div class="muted mt-2">‚è≥ –¢—Ä–∏–≤–∞–ª—ñ—Å—Ç—å: {{ r[4] }}</div>
            <div class="muted">üìù –ü—Ä–∏—á–∏–Ω–∞: {{ r[5] }}</div>

            <form method="post" action="/vehicles/return" class="mt-3">
              <input type="hidden" name="rental_id" value="{{ r[0] }}" />
              <button class="btn btn-success">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏</button>
            </form>
          </div>
        </div>
      {% else %}
        <div class="col-12">
          <div class="card p-4 text-center">
            <div class="h6 m-0 text-white-50">–ê–∫—Ç–∏–≤–Ω–∏—Ö –±—Ä–æ–Ω—é–≤–∞–Ω—å –Ω–µ–º–∞—î.</div>
          </div>
        </div>
      {% endfor %}
    </div>

  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
