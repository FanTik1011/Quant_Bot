<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <title>–Ü—Å—Ç–æ—Ä—ñ—è –¥—ñ–π | BCSD</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body {
            background: url("/static/bg.jpg") no-repeat center center fixed;
            background-size: cover;
            color: white;
        }
        .table-container {
            background-color: rgba(0, 0, 0, 0.75);
            padding: 2rem;
            border-radius: 1rem;
            margin-top: 2rem;
        }
        th, td {
            color: black !important;
            vertical-align: middle !important;
        }
        .table-dark th {
            background-color: #343a40;
        }
    </style>
</head>
<body>
<div class="container table-container">
    <h2 class="mb-4">üìã –Ü—Å—Ç–æ—Ä—ñ—è –¥—ñ–π –ö–∞–¥—Ä–æ–≤–æ–≥–æ –ê—É–¥–∏—Ç—É</h2>

    <div class="mb-3 d-flex justify-content-between">
        <a href="/dashboard" class="btn btn-outline-light">‚Üê –ù–∞–∑–∞–¥ –¥–æ Dashboard</a>
        <a href="/download_db" class="btn btn-warning">üì• –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ audit.db</a>
    </div>

    <table class="table table-bordered table-striped" id="historyTable">
        <thead class="table-dark">
        <tr>
            <th>–í–∏–∫–æ–Ω–∞–≤–µ—Ü—å</th>
            <th>–ö–æ–≥–æ</th>
            <th>–î—ñ—è</th>
            <th>–†–æ–ª—å</th>
            <th>–ü—Ä–∏—á–∏–Ω–∞</th>
            <th>–î–∞—Ç–∞</th>
        </tr>
        </thead>
        <tbody id="historyBody">
        </tbody>
    </table>
</div>

<script>
let offset = 0;
let loading = false;
const limit = 50;

async function loadMoreHistory() {
    if (loading) return;
    loading = true;

    const res = await fetch(`/history_data?offset=${offset}`);
    const data = await res.json();

    const tbody = document.getElementById("historyBody");
    data.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
            <td>${row.executor}</td>
            <td>${row.target}</td>
            <td>${row.action}</td>
            <td>${row.role}</td>
            <td>${row.reason}</td>
            <td>${row.date}</td>
        `;
        tbody.appendChild(tr);
    });

    offset += limit;
    loading = false;
}

window.addEventListener("scroll", () => {
    if (window.innerHeight + window.scrollY >= document.body.offsetHeight - 300) {
        loadMoreHistory();
    }
});

loadMoreHistory();
</script>
</body>
</html>
